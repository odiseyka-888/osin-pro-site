<script>
// –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
let currentUser = null;
let users = JSON.parse(localStorage.getItem('osint_users')) || [];
let userIdCounter = parseInt(localStorage.getItem('user_id_counter')) || 1;

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
function initializeCreatorAccount() {
    const creatorExists = users.find(u => u.username === 'Odiseyka');
    
    if (!creatorExists) {
        const creatorAccount = {
            id: 0, // —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π ID –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
            username: 'Odiseyka',
            email: 'vsemogishchi3zeus@gmail.com',
            password: 'qwerzxc987',
            registrationDate: new Date().toLocaleDateString('ru-RU'),
            role: 'CREATOR', // –æ—Å–æ–±–∞—è —Ä–æ–ª—å
            subscription: {
                active: true,
                type: 'CREATOR_LIFETIME',
                expiryDate: '9999-12-31', // –≤–µ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
                requestsUsed: 0,
                totalRequests: 999999 // –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ
            }
        };
        
        users.push(creatorAccount);
        localStorage.setItem('osint_users', JSON.stringify(users));
        console.log('[SYSTEM] Creator account created automatically');
    }
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.onload = function() {
    initializeCreatorAccount(); // —Å–æ–∑–¥–∞–µ–º –∞–∫–∫–∞—É–Ω—Ç —Å–æ–∑–¥–∞—Ç–µ–ª—è
    
    const savedUser = localStorage.getItem('current_user');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateUI();
    }
};

function login() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    const user = users.find(u => u.username === username && u.password === password);
    
    if (user) {
        currentUser = user;
        localStorage.setItem('current_user', JSON.stringify(user));
        updateUI();
        closeModal('loginModal');
        
        if (user.role === 'CREATOR') {
            alert(`[CREATOR MODE] –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞—Ç–µ–ª—å ${user.username}! üöÄ`);
        } else {
            alert(`[SUCCESS] –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.username}!`);
        }
    } else {
        alert('[ERROR] –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
    }
}

function updateProfileInfo() {
    if (!currentUser) return;

    document.getElementById('usernameDisplay').textContent = currentUser.username;
    document.getElementById('emailDisplay').textContent = currentUser.email;
    document.getElementById('userIdDisplay').textContent = currentUser.id.toString().padStart(6, '0');
    document.getElementById('avatarLetter').textContent = currentUser.username.charAt(0).toUpperCase();
    document.getElementById('regDate').textContent = currentUser.registrationDate;
    document.getElementById('usedRequests').textContent = currentUser.subscription.requestsUsed;
    document.getElementById('totalRequests').textContent = currentUser.subscription.totalRequests;

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–¥–ø–∏—Å–∫–µ
    const subscription = currentUser.subscription;
    const statusElement = document.getElementById('subscriptionStatus');
    const expiryElement = document.getElementById('expiryDate');
    const daysLeftElement = document.getElementById('daysLeft');
    const tariffElement = document.getElementById('tariffName');
    const accountStatusElement = document.getElementById('accountStatus');

    if (currentUser.role === 'CREATOR') {
        statusElement.textContent = '[CREATOR_ACCESS]';
        statusElement.className = 'subscription-status subscription-active';
        statusElement.style.color = '#ff9900'; // –æ—Å–æ–±—ã–π —Ü–≤–µ—Ç –¥–ª—è —Å–æ–∑–¥–∞—Ç–µ–ª—è
        expiryElement.textContent = '–í–ï–ß–ù–´–ô –î–û–°–¢–£–ü';
        daysLeftElement.textContent = '–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: ‚àû';
        tariffElement.textContent = 'CREATOR LIFETIME';
        tariffElement.style.color = '#ff9900';
        accountStatusElement.textContent = 'CREATOR';
        accountStatusElement.style.color = '#ff9900';
        daysLeftElement.style.color = '#ff9900';
    }
    else if (subscription.active && subscription.expiryDate) {
        const expiryDate = new Date(subscription.expiryDate);
        const today = new Date();
        const daysLeft = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));

        statusElement.textContent = '[SUBSCRIPTION_ACTIVE]';
        statusElement.className = 'subscription-status subscription-active';
        expiryElement.textContent = subscription.expiryDate;
        daysLeftElement.textContent = `–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: ${daysLeft}`;
        tariffElement.textContent = subscription.type;
        accountStatusElement.textContent = 'Active';

        if (daysLeft <= 3) {
            daysLeftElement.style.color = '#e74c3c';
        } else if (daysLeft <= 7) {
            daysLeftElement.style.color = '#f39c12';
        } else {
            daysLeftElement.style.color = '#27ae60';
        }
    } else {
        statusElement.textContent = '[SUBSCRIPTION_EXPIRED]';
        statusElement.className = 'subscription-status subscription-expired';
        expiryElement.textContent = '--.--.----';
        daysLeftElement.textContent = '–û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: 0';
        tariffElement.textContent = '–ù–µ –∞–∫—Ç–∏–≤–µ–Ω';
        accountStatusElement.textContent = 'Inactive';
        daysLeftElement.style.color = '#e74c3c';
    }
}
</script>